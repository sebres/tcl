# Commands covered:  http::config, http::geturl, http::wait, http::reset
#
# This file contains a collection of tests for the http script library.
# Sourcing this file into Tcl runs the tests and generates output for errors.
# No output means no errors were found.
#
# This file is a rewrite to demostrate TIP 452 (enhancement to tcltest for
# stubs/mocks and seams).  NOTE -- due to the use of stubs/mocks, no actual
# I/O is done, so the httpd package is no longer being used. Please also note,
# the seams feature is not used, only the stub/mock feature.
#
# Copyright (c) 1991-1993 The Regents of the University of California.
# Copyright (c) 1994-1996 Sun Microsystems, Inc.
# Copyright (c) 1998-2000 by Ajuba Solutions.
# Copyright (c) 2017 by Gerald W. Lester.
#
# See the file "license.terms" for information on usage and redistribution of
# this file, and for a DISCLAIMER OF ALL WARRANTIES.

package require tcltest 2.5

if {[catch {package require http 2} version]} {
    if {[info exists http2]} {
	catch {puts "Cannot load http 2.* package"}
	return
    } else {
	catch {puts "Running http 2.* tests in slave interp"}
	set interp [interp create http2]
	$interp eval [list set http2 "running"]
	$interp eval [list set argv $argv]
	$interp eval [list source [info script]]
	interp delete $interp
	return
    }
}

proc bgerror {args} {
    global errorInfo
    puts stderr "http.test bgerror"
    puts stderr [join $args]
    puts stderr $errorInfo
}

set bindata "This is binary data\x0d\x0amore\x0dmore\x0amore\x00null"
catch {unset data}

##
## Test http::config command -- not modified from original tests
##
::tcltest::test http-1.1 {http::config} {
    http::config -useragent UserAgent
    http::config
} [list -accept */* -proxyfilter http::ProxyRequired -proxyhost {} -proxyport {} -urlencoding utf-8 -useragent "UserAgent"]
::tcltest::test http-1.2 {http::config} {
    http::config -proxyfilter
} http::ProxyRequired
::tcltest::test http-1.3 {http::config} {
    catch {http::config -junk}
} 1
::tcltest::test http-1.4 {http::config} {
    set savedconf [http::config]
    http::config -proxyhost nowhere.come -proxyport 8080 \
	-proxyfilter myFilter -useragent "Tcl Test Suite" \
	-urlencoding iso8859-1
    set x [http::config]
    http::config {*}$savedconf
    set x
} {-accept */* -proxyfilter myFilter -proxyhost nowhere.come -proxyport 8080 -urlencoding iso8859-1 -useragent {Tcl Test Suite}}
::tcltest::test http-1.5 {http::config} -returnCodes error -body {
    http::config -proxyhost {} -junk 8080
} -result {Unknown option -junk, must be: -accept, -proxyfilter, -proxyhost, -proxyport, -urlencoding, -useragent}
::tcltest::test http-1.6 {http::config} -setup {
    set oldenc [http::config -urlencoding]
} -body {
    set enc [list [http::config -urlencoding]]
    http::config -urlencoding iso8859-1
    lappend enc [http::config -urlencoding]
} -cleanup {
    http::config -urlencoding $oldenc
} -result {utf-8 iso8859-1}


##
## Test http::geturl
##

##
## Happy path, no options
##
::tcltest::test http-2.1 {http::geturl -- Happy path, no options} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {::http::geturl {http://test.it/some/fragment}} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {0 ::http::1 {::after,count 0 ::fileevent,count 1 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 1 ::socket,count 1}}

##
## Happy path, with all options except:
##      -channel, -command, -keepalive and -querychannel
##
::tcltest::test http-2.2 {http::geturl with options} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {
            ::http::geturl {http://test.it/some/fragment} \
                -binary false \
                -blocksize 1024 \
                -handler SomeHandler \
                -headers {CustomHeader true CustomState no} \
                -method POST \
                -myaddr 1024:45 \
                -progress ProgressBar \
                -protocol 1.2 \
                -query SomeQuery \
                -queryblocksize 2020 \
                -queryprogress QueryProgressBar \
                -strict yes \
                -timeout 1000 \
                -type xml \
                -validate true
        } token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {0 ::http::1 {::after,count 1 ::fileevent,count 1 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 1 ::socket,count 1}}

##
## Bad options
##
::tcltest::test http-2.3 {http::geturl} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {
            ::http::geturl {http://test.it/some/fragment} \
                -oops
        } token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {1 {Unknown option -oops, can be: -binary, -blocksize, -channel, -command, -handler, -headers, -keepalive, -method, -myaddr, -progress, -protocol, -query, -queryblocksize, -querychannel, -queryprogress, -strict, -timeout, -type, -validate} {::after,count 0 ::fileevent,count 0 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 0 ::socket,count 0}}

##
## Good options, but invalid numeric value
##
::tcltest::test http-2.4a {http::geturl - Good options, but invalid numeric value for -blocksize} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {
            ::http::geturl {http://test.it/some/fragment} \
                -binary false \
                -blocksize QED \
                -handler SomeHandler \
                -headers {CustomHeader true CustomState no} \
                -method POST \
                -myaddr 1024:45 \
                -progress ProgressBar \
                -protocol 1.2 \
                -query SomeQuery \
                -queryblocksize 2020 \
                -queryprogress QueryProgressBar \
                -strict yes \
                -timeout 1000 \
                -type xml \
                -validate true
        } token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {1 {Bad value for -blocksize (QED), must be integer} {::after,count 0 ::fileevent,count 0 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 0 ::socket,count 0}}

::tcltest::test http-2.4b {http::geturl - Good options, but invalid numeric value for -queryblocksize} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {
            ::http::geturl {http://test.it/some/fragment} \
                -binary false \
                -blocksize 1024 \
                -handler SomeHandler \
                -headers {CustomHeader true CustomState no} \
                -method POST \
                -myaddr 1024:45 \
                -progress ProgressBar \
                -protocol 1.2 \
                -query SomeQuery \
                -queryblocksize QED \
                -queryprogress QueryProgressBar \
                -strict yes \
                -timeout 1000 \
                -type xml \
                -validate true
        } token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {1 {Bad value for -queryblocksize (QED), must be integer} {::after,count 0 ::fileevent,count 0 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 0 ::socket,count 0}}

::tcltest::test http-2.4c {http::geturl - Good options, but invalid numeric value for -timeout} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {
            ::http::geturl {http://test.it/some/fragment} \
                -binary false \
                -blocksize 1024 \
                -handler SomeHandler \
                -headers {CustomHeader true CustomState no} \
                -method POST \
                -myaddr 1024:45 \
                -progress ProgressBar \
                -protocol 1.2 \
                -query SomeQuery \
                -queryblocksize 1024 \
                -queryprogress QueryProgressBar \
                -strict yes \
                -timeout QED \
                -type xml \
                -validate true
        } token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {1 {Bad value for -timeout (QED), must be integer} {::after,count 0 ::fileevent,count 0 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 0 ::socket,count 0}}

##
## Invalid use of -query and -querychannel options
##
::tcltest::test http-2.5 {http::geturl -- Invalid use of -query and -querychannel options} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {
            ::http::geturl {http://test.it/some/fragment} \
                -query SomeQuery \
                -querychannel 10000
        } token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {1 {Can't combine -query and -querychannel options!} {::after,count 0 ::fileevent,count 0 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 0 ::socket,count 0}}

##
## Unsupported URL
##
::tcltest::test http-2.5 {http::geturl -- Unsupported URL} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {
            ::http::geturl {bad/url/me.test}} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {1 {Unsupported URL: bad/url/me.test} {::after,count 0 ::fileevent,count 0 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 0 ::socket,count 0}}

##
## Missing host
##
::tcltest::test http-2.7 {http::geturl -- Missing host} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {
            ::http::geturl {http://:20/some/fragment}} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {1 {Missing host part: http://:20/some/fragment} {::after,count 0 ::fileevent,count 0 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 0 ::socket,count 0}}

##
## Invalid port number
##
::tcltest::test http-2.8 {http::geturl - Invalid port number} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {
            ::http::geturl {http://test.it:99999999/some/fragment}} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {1 {Invalid port number: 99999999} {::after,count 0 ::fileevent,count 0 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 0 ::socket,count 0}}

##
## Illegal encoding character usage in URL user
##
::tcltest::test http-2.9 {http::geturl - Illegal encoding character usage in URL user} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {
            ::http::geturl {http://%@test.it/some/fragment} -strict yes} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {1 {Illegal encoding character usage "%" in URL user} {::after,count 0 ::fileevent,count 0 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 0 ::socket,count 0}}

##
## Illegal characters in URL user
##
::tcltest::test http-2.10 {http::geturl -- Illegal characters in URL user} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {
            ::http::geturl {http://{ME}@test.it/some/fragment}} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {1 {Illegal characters in URL user} {::after,count 0 ::fileevent,count 0 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 0 ::socket,count 0}}

##
## Path of URL is empty
##
::tcltest::test http-2.11 {http::geturl -- Path of URL is empty} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {
            ::http::geturl {http://test.it}} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {0 ::http::1 {::after,count 0 ::fileevent,count 1 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 1 ::socket,count 1}}

##
## Illegal encoding character usage in URL path
##
::tcltest::test http-2.12 {http::geturl -- Illegal encoding character usage in URL path} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {::http::geturl {http://foo.bar/test%--}} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {1 {Illegal encoding character usage "%--" in URL path} {::after,count 0 ::fileevent,count 0 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 0 ::socket,count 0}}

##
## Illegal characters in URL path
##
::tcltest::test http-2.13 {http::geturl - Illegal characters in URL path} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {::http::geturl {http://test.it/{}}} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {1 {Illegal characters in URL path} {::after,count 0 ::fileevent,count 0 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 0 ::socket,count 0}}

##
## Protocol missing
##
::tcltest::test http-2.14 {http::geturl - Protocol missing} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {::http::geturl {//test.it/}} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {0 ::http::1 {::after,count 0 ::fileevent,count 1 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 1 ::socket,count 1}}

##
## Unsupported URL type
##
::tcltest::test http-2.15 {http::geturl -- Unsupported URL type} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {::http::geturl {://test.it/}} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {1 {Unsupported URL: ://test.it/} {::after,count 0 ::fileevent,count 0 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 0 ::socket,count 0}}

##
## Port missing
##
::tcltest::test http-2.16 {http::geturl -- Port missing} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {::http::geturl {http://test.it:/}} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {1 {Missing host part: http://test.it:/} {::after,count 0 ::fileevent,count 0 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 0 ::socket,count 0}}

##
## Proxy Filter specified
##
::tcltest::test http-2.17 {http::geturl -- Proxy Filter specified} \
    -setup {
        set ::http::http(uid) {0}
        set ::http::http(-proxyfilter) {proxy.it 1028}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        ::http::config -proxyhost proxy.com -proxyport 1024
        set status [catch {::http::geturl {http://test.it/}} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {0 ::http::1 {::after,count 0 ::fileevent,count 1 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 1 ::socket,count 1}}

##
## Non-empty valid user
##
::tcltest::test http-2.18 {http::geturl -- Non-empty valid user} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {::http::geturl {http://jdoe@test.it/}} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {0 ::http::1 {::after,count 0 ::fileevent,count 1 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 1 ::socket,count 1}}

##
## Non default port specified
##
::tcltest::test http-2.19 {http::geturl - Non default port specified} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {::http::geturl {http://test.it:8080/}} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {0 ::http::1 {::after,count 0 ::fileevent,count 1 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 1 ::socket,count 1}}

##
## Timeout specified
##
::tcltest::test http-2.20 {http::geturl -- Timeout specified} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {::http::geturl {http://test.it/} -timeout 10} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {0 ::http::1 {::after,count 1 ::fileevent,count 1 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 1 ::socket,count 1}}

##
## Keep alive on closed channel
##
::tcltest::test http-2.21 {http::geturl -- Keep alive on closed channel} \
    -setup {
        set ::http::http(uid) {0}
        set ::http::defaultKeepalive true
        set http::socketmap(test.it:80) yes
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::fconfigure {
                * {
                    returns {Socket Closed}
                    code {error}
                    errorcode {HTTP TEST SOCKCLS}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {::http::geturl {http://test.it/} -keepalive yes} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {0 ::http::1 {::after,count 0 ::fconfigure,count 1 ::fileevent,count 1 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 1 ::socket,count 1}}

##
## Keep alive on open channel
##
::tcltest::test http-2.22 {http::geturl -- Keep alive on open channel} \
    -setup {
        set ::http::http(uid) {0}
        set ::http::defaultKeepalive true
        set http::socketmap(test.it:80) yes
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::fconfigure {
                * {
                    returns {}
                    code {ok}
                    errorcode {}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {::http::geturl {http://test.it/} -keepalive yes} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {0 ::http::1 {::after,count 0 ::fconfigure,count 1 ::fileevent,count 3 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 1 ::socket,count 0}}

##
## Keep alive on new channel
##
::tcltest::test http-2.23 {http::geturl -- Keep alive on new channel} \
    -setup {
        set ::http::http(uid) {0}
        set ::http::defaultKeepalive true
        unset -nocomplain http::socketmap
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {::http::geturl {http://test.it/} -keepalive yes} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {0 ::http::1 {::after,count 0 ::fileevent,count 1 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 1 ::socket,count 1}}


##
## New socket with -myaddr specified
##
::tcltest::test http-2.24 {http::geturl -- New socket with -myaddr specified} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {::http::geturl {http://test.it/} -myaddr Interface1} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {0 ::http::1 {::after,count 0 ::fileevent,count 1 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 1 ::socket,count 1}}

##
## Error when opening the connection
##
::tcltest::test http-2.25 {http::geturl -- Error when opening the connection} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {Failed Socket Open}
                    errorcode {HTTP TEST SOCKERR}
                    code {error}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {::http::geturl {http://test.it/} -myaddr Interface1} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {1 {Failed Socket Open} {::after,count 0 ::fileevent,count 0 ::http::cleanup,count 1 ::http::Finish,count 1 ::http::reset,count 1 ::http::wait,count 0 ::socket,count 1}}

##
## Synchronus connection with timeout
##
::tcltest::test http-2.26 {http::geturl -- Synchronus connection with timeout} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                    use {
                        prefix {unset}
                    }
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {::http::geturl {http://test.it/}} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {0 ::http::1 {::after,count 0 ::fileevent,count 1 ::http::cleanup,count 0 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 1 ::socket,count 1}}

##
## Synchronus connection with error
##
::tcltest::test http-2.27 {http::geturl -- Synchronus connection with error} \
    -setup {
        set ::http::http(uid) {0}
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {}
                    code {ok}
                }
            }
            ::after {
                * {
                    returns {test::afterId}
                    errorcode {}
                }
            }
            ::socket {
                * {
                    returns {TestSocket}
                    errorcode {}
                }
            }
            ::http::reset {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::wait {
                * {
                    returns {}
                    errorcode {}
                    set {
                        ::http::1 A {status error error TestError}
                    }
                }
            }
            ::http::cleanup {
                * {
                    returns {}
                    errorcode {}
                }
            }
            ::http::Finish {
                * {
                    returns {}
                }
            }
        }
    } \
    -body {
        set status [catch {::http::geturl {http://test.it/}} token]
        list $status $token [::tcltest::callCount]
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {1 TestError {::after,count 0 ::fileevent,count 1 ::http::cleanup,count 1 ::http::Finish,count 0 ::http::reset,count 1 ::http::wait,count 1 ::socket,count 1}}



##
## Test http::formatQuery
##
::tcltest::test http-3.1 {http::formatQuery}  \
    -setup {

    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}


##
## Test http::reset
##

##
## Happy path
##
::tcltest::test http-4.1 {http::reset} \
    -setup {
        array set ::http_1 {
            sock none
        }
        unset -nocomplain ::http_1(error)
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {Test error}
                    code {error}
                    errorcode {HTTP TEST RESET FILEEVENT}
                }
            }
            ::http::Finish {
                * {
                    returns {No Error}
                    errorcode {}
                    set {
                        ::http_1 A {
                            status {---}
                        }
                    }
                }
            }
        }
    } \
    -body {
        list [catch {::http::reset ::http_1}] [info exists ::http_1] [::tcltest::callCount]
    } \
    -result {0 1 {::fileevent,count 2 ::http::Finish,count 1}} \
    -cleanup {
        ::tcltest::testCleanup
    }

##
## Test error
#
::tcltest::test http-4.2 {http::rest} \
    -setup {
        array set ::http_1 {
            sock none
        }
        unset -nocomplain ::http_1(error)
        ::tcltest::testSetup {
            ::fileevent {
                * {
                    returns {Test error}
                    code {error}
                    errorcode {HTTP TEST RESET FILEEVENT}
                }
            }
            ::http::Finish {
                * {
                    returns {No Error}
                    errorcode {}
                    set {
                        ::http_1 A {
                            status {---}
                            error {{HTTP TEST ERROR}}
                        }
                    }
                }
            }
        }
    } \
    -body {
        list [catch {::http::reset ::http_1} result] [info exists ::http_1] [::tcltest::callCount] $result
    } \
    -result {1 0 {::fileevent,count 2 ::http::Finish,count 1} {HTTP TEST ERROR}} \
    -cleanup {
        ::tcltest::testCleanup
    }


##
## Test http::wait
##
::tcltest::test http-5.1 {http::wait} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}


##
## Testhttp::data
##
::tcltest::test http-6.1 {http::data} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}


##
## Test http::error
##
::tcltest::test http-7.1 {http::error} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}


##
## Test http::status
##
::tcltest::test http-8.1 {http::status} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}


##
## Test http::code
##
::tcltest::test http-9.1 {http::code} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}


##
## Test http::ncode
##
::tcltest::test http-10.1 {http::ncode} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}

##
## Test http::size
##
::tcltest::test http-11.1 {http::size} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}

##
## Test http::me
##
::tcltest::test http-12.1 {http::size} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}


##
## Test http::cleanup
##
::tcltest::test http-13.1 {http::cleanup} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}


##
## Test http::register
##
::tcltest::test http-15.1 {http::register} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}


##
## Test http::unregister
##
::tcltest::test http-16.1 {http::unregister} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}


##
## Test http::Finish
##
::tcltest::test http-17.1 {http::Finish}  \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}



##
## Test http::Connected
##
::tcltest::test http-18.1 {http::Connected}  \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}

##
## Test http::Connect
##
::tcltest::test http-19.1 {http::Connect}  \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}

##
## Test http::Write
##
::tcltest::test http-20.1 {http::Write} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}

##
## Test http::Event
##
::tcltest::test http-21.1 {http::Event} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}

##
## Test http::IsBinaryContentType
##
::tcltest::test http-22.1 {http::IsBinaryContentType} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}


##
## Test http::CopyStart
###
::tcltest::test http-23.1 {http::CopyStart} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}

##
## Test http::CopyChunk
##
::tcltest::test http-24.1 {http::CopyChunk} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}

##
## Test http::CopyDone
##
::tcltest::test http-25.1 {http::CopyDone} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}


##
## Test http::EOF
##
::tcltest::test http-26.1 {http::EOF} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}


##
## Test http::mapReply
##
::tcltest::test http-27.1 {http::mapReply} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}

##
## Test http::ProxyRequire
##
::tcltest::test http-28.1 {http::ProxyRequire} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}


##
## Test http::CharsetToEncoding
##
::tcltest::test http-29.1 {http::CharsetToEncoding} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}

##
## Test http::ContentEncoding
##
::tcltest::test http-30.1 {http::ContentEncoding} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}


##
## Test http::make-transformation-chunked
##
::tcltest::test http-31.1 {http::make-transformation-chunked} \
    -setup {
    } \
    -body {
        list Test Not Yet Implemented
    } \
    -cleanup {
        ::tcltest::testCleanup
    } \
    -result {}


# cleanup
catch {unset url}
catch {unset badurl}
catch {unset port}
catch {unset data}

rename bgerror {}
::tcltest::cleanupTests

# Local variables:
# mode: tcl
# End:
