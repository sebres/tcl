name: msys2

on:
  push:

jobs:
  build:
    runs-on: windows-latest

    defaults:
      run:
        shell: msys2 {0}
        working-directory: unix

    steps:
      - name: Init MSYS
        uses: msys2/setup-msys2@v2
        with:
          msystem: MSYS
          install: git base-devel msys2-devel zlib
          update: true
      - name: Checkout
        uses: actions/checkout@v2
      - name: Build
        run: |
          autoreconf -vfi
          ./configure -C --prefix=/usr --enable-64bit || { cat config.log; cat config.cache; exit 1; }
          make
      - name: Run Tests (ignoring test io-53.4.1 which hangs)
        run: make test
        env:
          ERROR_ON_FAILURES: 1
          TESTFLAGS: -skip io-53.4.1 -verbose bpsel
